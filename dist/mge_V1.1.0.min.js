const mge={TITLE:'Mini Game Engine',VERSION:'V1.1.0',bf:{},br:{},cg:{},da:{},du:{},cj:{},hh:{}};mge.audio={get currentAudioTime(){return mge.bf.ah.currentTime},get volume(){return mge.bf.bg},set volume(_value){mge.bf.bc(_value)},playSound:function(ak,am,ad,ae,bg){mge.bf.aj(ak,mge.bf.ai,am,ad,ae,bg)}};mge.sequencer={get bpm(){return mge.hh.ft},set bpm(_value){mge.hh.ft=_value},createTrack:function(fz,ga,bg){return mge.hh.fy(fz,ga,bg)},start:function(){mge.hh.cc()},stop:function(){mge.hh.gz()},reset:function(){mge.hh.hi()}};mge.game={get width(){return mge.br.bk.width},set width(_value){mge.br.bk.width=_value},get height(){return mge.br.bk.height},set height(_value){mge.br.bk.height=_value},get fps(){return mge.da.cv},get clonesNb(){return mge.cg.cf()},get context(){return mge.br.bl},start:function(cb){mge.cg.cc(cb)},changeScene:function(cb){mge.cg.ca(cb)},createSprite:function(){return mge.cg.bx()}};mge.keyboard={get keysPressed(){return mge.cj.ci},isKeyPressed:function(cm){return mge.cj.ck(cm)}};mge.mouse={get isClicked(){return mge.du.dc},get isDown(){return mge.du.dd},get isUp(){return mge.du.de},get isPressed(){return mge.du.df},get isReleased(){return mge.du.dg},get x(){return mge.du._x},get y(){return mge.du._y}};mge.fr={set drawFunction(_value){this.dw=_value},get width(){return this.bh},set width(_value){this.bh=_value},get height(){return this.bi},set height(_value){this.bi=_value},get x(){return this._x},set x(_value){this._x=_value},get y(){return this._y},set y(_value){this._y=_value},get scaleX(){return this.bo},set scaleX(_value){this.bo=_value},get scaleY(){return this.bp},set scaleY(_value){this.bp=_value},get isVisible(){return this.eb},set isVisible(_value){this.eb=_value},get drawBoundaries(){return this.ec},set drawBoundaries(_value){this.ec=_value},get isTouched(){return this.et()},get isClicked(){return this.dc()},get isDragged(){return this.es()},get isSelected(){return this.fa()},draw:function(){this.eh()},cloneCreate:function(){return this.fd()},cloneDelete:function(){this.fi()},cloneDeleteAll:function(){this.fg()},cloneExecuteForEach:function(_method){return this.fk(_method)}};mge.bf.aa=function(ab,ac,ad,ae){let a=ab.a||0.0001;let d=ab.d||0.0001;let s=ab.s||0.0001;let r=ab.r||0.0001;let af=ab.minValue||0.0001;let ag=ab.maxValue||1;if(ae<=a){ac.setValueAtTime(af,ad);ac.exponentialRampToValueAtTime(ag*ae/a,ad+ae);ac.exponentialRampToValueAtTime(af,ad+ae+r)}else if(ae<=a+d){ac.setValueAtTime(af,ad);ac.exponentialRampToValueAtTime(ag,ad+a);ac.exponentialRampToValueAtTime(ag*s*d/ae,ad+ae);ac.exponentialRampToValueAtTime(af,ad+ae+r)}else{ac.setValueAtTime(af,ad);ac.exponentialRampToValueAtTime(ag,ad+a);ac.exponentialRampToValueAtTime(ag*s,ad+a+d);ac.setValueAtTime(ag*s,ad+ae);ac.exponentialRampToValueAtTime(af,ad+ae+r)}};mge.bf.hi=function(){this.ah='';this.ai='';this.bg=1;this.ah=new(window.AudioContext||window.webkitAudioContext)();this.ai=this.ah.createGain();this.ai.connect(this.ah.destination)};mge.bf.aj=function(ak,al,am,ad,ae,bg){let ar=ak.oscType||'sine';let as=ak.filterType||'lowpass';let at=ak.volumeADSR||{a:0,d:0,s:1,r:0,minValue:1,maxValue:1};let au=ak.pitchADSR||{a:0,d:0,s:1,r:0,minValue:am,maxValue:am};let av=ak.detuneADSR||{a:0,d:0,s:1,r:0,minValue:0,maxValue:0};let aw=ak.filterFreqADSR||{a:0,d:0,s:1,r:0,minValue:20000,maxValue:20000};let ax=ak.filterQADSR||{a:0,d:0,s:1,r:0,minValue:1,maxValue:1};let bb='';if(ar=='noise'){bb=this.ah.createBufferSource();let buffer=this.ah.createBuffer(1,this.ah.sampleRate*(ae+at.r),this.ah.sampleRate);let noiseOutput=buffer.getChannelData(0);for(let i=0;i<buffer.length;i++){noiseOutput[i]=Math.random()*2-1};bb.buffer=buffer;}else{bb=this.ah.createOscillator();bb.type=ar;this.aa(au,bb.frequency,ad,ae);this.aa(av,bb.detune,ad,ae)};bb.start(ad);bb.stop(ad+ae+at.r);let ay=this.ah.createGain();this.aa(at,ay.gain,ad,ae);let az=this.ah.createGain();az.gain.setValueAtTime(mge.bf.bd(bg)*0.04,ad);let ba=this.ah.createBiquadFilter();ba.type=as;this.aa(aw,ba.frequency,ad,ae);this.aa(ax,ba.Q,ad,ae);bb.connect(ba);ba.connect(ay);ay.connect(az);az.connect(al)};mge.bf.bc=function(bg){if(bg<=0){mge.bf.bg=0}else if(bg>=1){mge.bf.bg=1}else{mge.bf.bg=bg};mge.bf.ai.gain.setValueAtTime(mge.bf.bd(mge.bf.bg),mge.audio.currentAudioTime)};mge.bf.bd=function(bg){let be=30;if(bg<=0){return 0;}else if(bg>=1){return 1;}else{return Math.pow(10,(bg-1)*be/10)}};mge.br.hi=function(bh,bi,bj){this.bk='';this.bl='';this.bk=document.getElementById(bj);if(this.bk){this.bk.remove()};this.bk=document.createElement('canvas');this.bk.id=bj;this.bk.width=bh;this.bk.height=bi;document.body.appendChild(this.bk);this.bl=this.bk.getContext('2d')};mge.br.bm=function(){let bo=(window.innerWidth-10)/this.bk.width;let bp=(window.innerHeight-10)/this.bk.height;let bq=Math.min(bo,bp);this.bk.style.transform='scale('+bq+')';this.bk.display='block'};mge.cg.hi=function(bh,bi){this.bu='';this.bv='';this.bw=[];mge.br.hi(bh,bi,'GAME_RENDER_CANVAS');mge.du.hi(mge.br.bk);mge.cj.hi();mge.bf.hi();mge.hh.hi();mge.da.hi()};mge.cg.bx=function(){let bz=Object.create(mge.fr);bz.hi(mge.br.bl);mge.cg.bw.push(bz);return bz};mge.cg.cf=function(){let ce=0;this.bw.forEach(fr=>{ce+=fr.ef.length;});return ce};mge.cg.ca=function(cb){if(!cb.start){cb.start=function(){}};if(!cb.update){cb.update=function(){}};if(!cb.draw){cb.draw=function(){}};this.bv=cb};mge.cg.cc=function(cb){this.ca(cb);mge.da.cc()};mge.cj.ck=function(cm){if(this.ci.indexOf(cm)==-1){return false;}else{return true}};mge.cj.cl=function(e){if(this.ch.indexOf(e.key)==-1){this.ch.push(e.key)}};mge.cj.cn=function(e){let indexOfKey=this.ch.indexOf(e.key);if(indexOfKey !=-1){this.ch.splice(indexOfKey,1)}};mge.cj.cp=function(){this.ci=[];this.ch=[]};mge.cj.cq=function(){this.ci=this.ch.slice()};mge.cj.hi=function(){this.ci=[];this.ch=[];document.onkeydown=function(e){mge.cj.cl(e)};document.onkeyup=function(e){mge.cj.cn(e)}};mge.da.hi=function(){this.cs=0;this.ct=0;this.cu=0;this.cv=0};mge.da.cc=function(){this.cy()};mge.da.cy=function(){mge.da.ct=performance.now();mge.da.cu=mge.da.ct-mge.da.cs;mge.da.cv=1/(mge.da.cu/1000);if(mge.da.cu>=16){mge.du.cq();mge.cj.cq();if(mge.cg.bu !=mge.cg.bv){mge.cg.bu=mge.cg.bv;mge.du.cp();mge.cj.cp();mge.cg.bu.start()};mge.cg.bu.update();mge.cg.bw.forEach(fr=>{fr.fb();});mge.br.bl.clearRect(0,0,mge.br.bk.width,mge.br.bk.height);mge.cg.bu.draw();mge.br.bm();mge.hh.gv();mge.da.cs=mge.da.ct};requestAnimationFrame(mge.da.cy)};mge.du.dm=function(e){this.dj=true;this.dh=e.offsetX;this.di=e.offsetY};mge.du.dn=function(e){this.dk=true};mge.du.dp=function(e){this.dh=e.offsetX;this.di=e.offsetY};mge.du.dq=function(e){this.dh='';this.di='';this.dl=true};mge.du.dr=function(e){this.dl=true};mge.du.cp=function(){this._x=0;this._y=0;this.dc=false;this.dd=false;this.de=true;this.df=false;this.dg=false;this.dh=0;this.di=0;this.dj=false;this.dk=false;this.dl=false};mge.du.cq=function(){this._x=this.dh;this._y=this.di;this.dc=this.dj;this.dj=false;this.df=false;if(this.dk){this.dd=true;this.de=false;this.dk=false;this.df=true};this.dg=false;if(this.dl){this.dd=false;this.de=true;this.dl=false;this.dg=true}};mge.du.hi=function(bn){this._x=0;this._y=0;this.dc=false;this.dd=false;this.de=true;this.df=false;this.dg=false;this.dh=0;this.di=0;this.dj=false;this.dk=false;this.dl=false;bn.onclick=function(e){mge.du.dm(e)};bn.onmousemove=function(e){mge.du.dp(e)};bn.onmouseout=function(e){mge.du.dq(e)};bn.onmousedown=function(e){mge.du.dn(e)};bn.onmouseup=function(e){mge.du.dr(e)}};mge.fr.hi=function(dv){this.dv=dv;this.dw=function(){};this.bh=100;this.bi=100;this._x=0;this._y=0;this.bo=1;this.bp=1;this.eb=true;this.ec=false;this.ed=false;this.ee=false;this.ef=[];this.eg=false};mge.fr.eh=function(){if(this.eb){let dv=this.dv;dv.save();dv.translate(this._x-this.bh*this.bo/2,this._y-this.bi*this.bp/2);dv.scale(this.bo,this.bp);this.dw(dv);if(this.ec){dv.strokeStyle='red';dv.strokeRect(0,0,this.bh,this.bi);dv.strokeRect(this.bh/2,this.bi/2,1,1)};dv.restore()}};mge.fr.dc=function(){if(this.et()&& mge.du.dc){return true;}else{return false}};mge.fr.es=function(){if(this.et()&& mge.du.df){this.ed=true};if(this.ed && mge.du.dd){this.ed=true;}else{this.ed=false};return this.ed};mge.fr.fa=function(){if(this.et()&& mge.du.df){this.ee=true};if(!this.et()&& mge.du.df){this.ee=false};return this.ee};mge.fr.et=function(){let ew=this._x+(this.bh/2)*this.bo;let ex=this._x-(this.bh/2)*this.bo;let ey=this._y+(this.bi/2)*this.bp;let ez=this._y-(this.bi/2)*this.bp;if(mge.du._x>=ex && mge.du._x<=ew && mge.du._y>=ez && mge.du._y<=ey){return true;}else{return false}};mge.fr.fb=function(){let fc=[];this.ef.forEach(fq=>{if(fq.eg){fc.push(fq)};});this.ef=fc};mge.fr.fd=function(){let fq=Object.create(this);fq.eg=true;this.ef.push(fq);return fq};mge.fr.fi=function(){this.eg=false};mge.fr.fg=function(){this.ef=[]};mge.fr.fk=function(_method){this.ef.forEach(fq=>{fq[_method]();})};mge.hh.hi=function(){this.fs=[];this.ft=60;this.fu=1;this.fv=0;this.fw=0;this.cw='stopped'};mge.hh.gf=function(gg){let gh={C:32.7,Db:34.6,D:36.7,Eb:38.9,E:41.2,F:43.6,Gb:46.2,G:49,Ab:51.9,A:55,Bb:58.3,B:61.7};let gi=parseInt(gg.substr(gg.length-1,gg.length),10);let gj=gg.substr(0,gg.length-1);let am=gh[gj]*Math.pow(2,gi);return Math.round(am)};mge.hh.fy=function(fz,ga,bg){let ge=Object.create(mge.hh.gd);ge.fz=fz;ge.ga=ga;ge.bg=bg;mge.hh.fs.push(ge);return ge};mge.hh.gl=function(gd,gn){let gq=gd.hf(gn);let gr=this.fv;for(let i=0;i<gq.length;i+=2){let gj=gq[i];let gjFrequency=this.gf(gj);let ae=gq[i+1]*60/this.ft;gd.ga.play(gjFrequency,gr,ae,gd.bg);gr+=ae}};mge.hh.gv=function(){if(mge.bf.ah.currentTime>=this.fw && this.cw=='started'){for(let i=0;i<this.fs.length;i++){let gd=this.fs[i];this.gl(gd,this.fu)};this.fu+=1;this.fw=this.fv+3*60/this.ft;this.fv+=4*60/this.ft}};mge.hh.cc=function(){this.fu=1;this.fv=mge.bf.ah.currentTime;this.fw=0;this.cw='started'};mge.hh.gz=function(){this.cw='stopped'};mge.hh.gd={fz:[],ga:{},bg:1,bc:function(bg){if(bg<=0){this.bg=0}else if(bg>=1){this.bg=1}else{this.bg=bg}},hf:function(hg){let _nbBars=this.fz.length;if(_nbBars==0){return ''}else if(hg%_nbBars==0){return this.fz[_nbBars-1]}else{return this.fz[hg%_nbBars-1]}}};mge.cg.hi(640,360)