const mge={TITLE:'Mini Game Engine',VERSION:'V1.1.1',bi:{},bu:{},cj:{},dd:{},dx:{},cm:{},hl:{}};mge.audio={get currentAudioTime(){return mge.bi.ah.currentTime},get volume(){return mge.bi.bj},set volume(_value){mge.bi.bf(_value)},playSound:function(ak,am,ad,ae,bj){mge.bi.aj(ak,mge.bi.ai,am,ad,ae,bj)}};mge.sequencer={get bpm(){return mge.hl.fw},set bpm(_value){mge.hl.fw=_value},createTrack:function(gc,gd,bj){return mge.hl.gb(gc,gd,bj)},start:function(){mge.hl.cf()},stop:function(){mge.hl.hc()},reset:function(){mge.hl.hm()}};mge.game={get width(){return mge.bu.bn.width},set width(_value){mge.bu.bn.width=_value},get height(){return mge.bu.bn.height},set height(_value){mge.bu.bn.height=_value},get fps(){return mge.dd.cy},get clonesNb(){return mge.cj.ci()},get context(){return mge.bu.bo},start:function(ce){mge.cj.cf(ce)},changeScene:function(ce){mge.cj.cd(ce)},createSprite:function(){return mge.cj.ca()}};mge.keyboard={get keysPressed(){return mge.cm.cl},isKeyPressed:function(cp){return mge.cm.cn(cp)}};mge.mouse={get isClicked(){return mge.dx.df},get isDown(){return mge.dx.dg},get isUp(){return mge.dx.dh},get isPressed(){return mge.dx.di},get isReleased(){return mge.dx.dj},get x(){return mge.dx._x},get y(){return mge.dx._y}};mge.fu={set drawFunction(_value){this.dz=_value},get width(){return this.bk},set width(_value){this.bk=_value},get height(){return this.bl},set height(_value){this.bl=_value},get x(){return this._x},set x(_value){this._x=_value},get y(){return this._y},set y(_value){this._y=_value},get scaleX(){return this.br},set scaleX(_value){this.br=_value},get scaleY(){return this.bs},set scaleY(_value){this.bs=_value},get isVisible(){return this.ee},set isVisible(_value){this.ee=_value},get drawBoundaries(){return this.ef},set drawBoundaries(_value){this.ef=_value},get isTouched(){return this.ew()},get isClicked(){return this.df()},get isDragged(){return this.ev()},get isSelected(){return this.fd()},draw:function(){this.ek()},cloneCreate:function(){return this.fg()},cloneDelete:function(){this.fl()},cloneDeleteAll:function(){this.fj()},cloneExecuteForEach:function(_method){return this.fn(_method)}};mge.bi.aa=function(ab,ac,ad,ae){let a=ab.a||0.0001;let d=ab.d||0.0001;let s=ab.s||0.0001;let r=ab.r||0.0001;let af=ab.minValue||0.0001;let ag=ab.maxValue||1;if(ae<=a){ac.setValueAtTime(af,ad);ac.exponentialRampToValueAtTime(ag*ae/a,ad+ae);ac.exponentialRampToValueAtTime(af,ad+ae+r)}else if(ae<=a+d){ac.setValueAtTime(af,ad);ac.exponentialRampToValueAtTime(ag,ad+a);ac.exponentialRampToValueAtTime(ag*s*d/ae,ad+ae);ac.exponentialRampToValueAtTime(af,ad+ae+r)}else{ac.setValueAtTime(af,ad);ac.exponentialRampToValueAtTime(ag,ad+a);ac.exponentialRampToValueAtTime(ag*s,ad+a+d);ac.setValueAtTime(ag*s,ad+ae);ac.exponentialRampToValueAtTime(af,ad+ae+r)}};mge.bi.hm=function(){this.ah='';this.ai='';this.bj=1;this.ah=new(window.AudioContext||window.webkitAudioContext)();this.ai=this.ah.createGain();this.ai.connect(this.ah.destination)};mge.bi.aj=function(ak,al,am,ad,ae,bj){let ar=ak.oscType||'sine';let as=ak.filterType||'lowpass';let at=ak.volumeADSR||{a:0,d:0,s:1,r:0,minValue:1,maxValue:1};let au=ak.pitchADSR||{a:0,d:0,s:1,r:0,minValue:am,maxValue:am};let av=ak.detuneADSR||{a:0,d:0,s:1,r:0,minValue:0,maxValue:0};let aw=ak.filterFreqADSR||{a:0,d:0,s:1,r:0,minValue:20000,maxValue:20000};let ax=ak.filterQADSR||{a:0,d:0,s:1,r:0,minValue:1,maxValue:1};let bc=ak.reverb||{delay:0,feedbackLevel:0};let bb='';if(ar=='noise'){bb=this.ah.createBufferSource();let buffer=this.ah.createBuffer(1,this.ah.sampleRate*(ae+at.r),this.ah.sampleRate);let noiseOutput=buffer.getChannelData(0);for(let i=0;i<buffer.length;i++){noiseOutput[i]=Math.random()*2-1};bb.buffer=buffer;}else{bb=this.ah.createOscillator();bb.type=ar;this.aa(au,bb.frequency,ad,ae);this.aa(av,bb.detune,ad,ae)};bb.start(ad);bb.stop(ad+ae+at.r);let ay=this.ah.createGain();this.aa(at,ay.gain,ad,ae);let az=this.ah.createGain();az.gain.setValueAtTime(mge.bi.bg(bj)*0.04,ad);let ba=this.ah.createBiquadFilter();ba.type=as;this.aa(aw,ba.frequency,ad,ae);this.aa(ax,ba.Q,ad,ae);let bd=new DelayNode(this.ah,{delayTime:bc.delay});let be=this.ah.createGain();be.gain.value=bc.feedbackLevel;bb.connect(ba);ba.connect(ay);ay.connect(az);az.connect(al);ay.connect(bd);bd.connect(be);be.connect(bd);bd.connect(az)};mge.bi.bf=function(bj){if(bj<=0){mge.bi.bj=0}else if(bj>=1){mge.bi.bj=1}else{mge.bi.bj=bj};mge.bi.ai.gain.setValueAtTime(mge.bi.bg(mge.bi.bj),mge.audio.currentAudioTime)};mge.bi.bg=function(bj){let bh=30;if(bj<=0){return 0;}else if(bj>=1){return 1;}else{return Math.pow(10,(bj-1)*bh/10)}};mge.bu.hm=function(bk,bl,bm){this.bn='';this.bo='';this.bn=document.getElementById(bm);if(this.bn){this.bn.remove()};this.bn=document.createElement('canvas');this.bn.id=bm;this.bn.width=bk;this.bn.height=bl;document.body.appendChild(this.bn);this.bo=this.bn.getContext('2d')};mge.bu.bp=function(){let br=(window.innerWidth-10)/this.bn.width;let bs=(window.innerHeight-10)/this.bn.height;let bt=Math.min(br,bs);this.bn.style.transform='scale('+bt+')';this.bn.display='block'};mge.cj.hm=function(bk,bl){this.bx='';this.by='';this.bz=[];mge.bu.hm(bk,bl,'GAME_RENDER_CANVAS');mge.dx.hm(mge.bu.bn);mge.cm.hm();mge.bi.hm();mge.hl.hm();mge.dd.hm()};mge.cj.ca=function(){let cc=Object.create(mge.fu);cc.hm(mge.bu.bo);mge.cj.bz.push(cc);return cc};mge.cj.ci=function(){let ch=0;this.bz.forEach(fu=>{ch+=fu.ei.length;});return ch};mge.cj.cd=function(ce){if(!ce.start){ce.start=function(){}};if(!ce.update){ce.update=function(){}};if(!ce.draw){ce.draw=function(){}};this.by=ce};mge.cj.cf=function(ce){this.cd(ce);mge.dd.cf()};mge.cm.cn=function(cp){if(this.cl.indexOf(cp)==-1){return false;}else{return true}};mge.cm.co=function(e){if(this.ck.indexOf(e.key)==-1){this.ck.push(e.key)}};mge.cm.cq=function(e){let indexOfKey=this.ck.indexOf(e.key);if(indexOfKey !=-1){this.ck.splice(indexOfKey,1)}};mge.cm.cs=function(){this.cl=[];this.ck=[]};mge.cm.ct=function(){this.cl=this.ck.slice()};mge.cm.hm=function(){this.cl=[];this.ck=[];document.onkeydown=function(e){mge.cm.co(e)};document.onkeyup=function(e){mge.cm.cq(e)}};mge.dd.hm=function(){this.cv=0;this.cw=0;this.cx=0;this.cy=0};mge.dd.cf=function(){this.db()};mge.dd.db=function(){mge.dd.cw=performance.now();mge.dd.cx=mge.dd.cw-mge.dd.cv;mge.dd.cy=1/(mge.dd.cx/1000);if(mge.dd.cx>=16){mge.dx.ct();mge.cm.ct();if(mge.cj.bx !=mge.cj.by){mge.cj.bx=mge.cj.by;mge.dx.cs();mge.cm.cs();mge.cj.bx.start()};mge.cj.bx.update();mge.cj.bz.forEach(fu=>{fu.fe();});mge.bu.bo.clearRect(0,0,mge.bu.bn.width,mge.bu.bn.height);mge.cj.bx.draw();mge.bu.bp();mge.hl.gy();mge.dd.cv=mge.dd.cw};requestAnimationFrame(mge.dd.db)};mge.dx.dq=function(e){this.dm=true;this.dk=e.offsetX;this.dl=e.offsetY};mge.dx.dr=function(e){this.dn=true};mge.dx.ds=function(e){this.dk=e.offsetX;this.dl=e.offsetY};mge.dx.dt=function(e){this.dk='';this.dl='';this.dp=true};mge.dx.du=function(e){this.dp=true};mge.dx.cs=function(){this._x=0;this._y=0;this.df=false;this.dg=false;this.dh=true;this.di=false;this.dj=false;this.dk=0;this.dl=0;this.dm=false;this.dn=false;this.dp=false};mge.dx.ct=function(){this._x=this.dk;this._y=this.dl;this.df=this.dm;this.dm=false;this.di=false;if(this.dn){this.dg=true;this.dh=false;this.dn=false;this.di=true};this.dj=false;if(this.dp){this.dg=false;this.dh=true;this.dp=false;this.dj=true}};mge.dx.hm=function(bq){this._x=0;this._y=0;this.df=false;this.dg=false;this.dh=true;this.di=false;this.dj=false;this.dk=0;this.dl=0;this.dm=false;this.dn=false;this.dp=false;bq.onclick=function(e){mge.dx.dq(e)};bq.onmousemove=function(e){mge.dx.ds(e)};bq.onmouseout=function(e){mge.dx.dt(e)};bq.onmousedown=function(e){mge.dx.dr(e)};bq.onmouseup=function(e){mge.dx.du(e)}};mge.fu.hm=function(dy){this.dy=dy;this.dz=function(){};this.bk=100;this.bl=100;this._x=0;this._y=0;this.br=1;this.bs=1;this.ee=true;this.ef=false;this.eg=false;this.eh=false;this.ei=[];this.ej=false};mge.fu.ek=function(){if(this.ee){let dy=this.dy;dy.save();dy.translate(this._x-this.bk*this.br/2,this._y-this.bl*this.bs/2);dy.scale(this.br,this.bs);this.dz(dy);if(this.ef){dy.strokeStyle='red';dy.strokeRect(0,0,this.bk,this.bl);dy.strokeRect(this.bk/2,this.bl/2,1,1)};dy.restore()}};mge.fu.df=function(){if(this.ew()&& mge.dx.df){return true;}else{return false}};mge.fu.ev=function(){if(this.ew()&& mge.dx.di){this.eg=true};if(this.eg && mge.dx.dg){this.eg=true;}else{this.eg=false};return this.eg};mge.fu.fd=function(){if(this.ew()&& mge.dx.di){this.eh=true};if(!this.ew()&& mge.dx.di){this.eh=false};return this.eh};mge.fu.ew=function(){let ez=this._x+(this.bk/2)*this.br;let fa=this._x-(this.bk/2)*this.br;let fb=this._y+(this.bl/2)*this.bs;let fc=this._y-(this.bl/2)*this.bs;if(mge.dx._x>=fa && mge.dx._x<=ez && mge.dx._y>=fc && mge.dx._y<=fb){return true;}else{return false}};mge.fu.fe=function(){let ff=[];this.ei.forEach(ft=>{if(ft.ej){ff.push(ft)};});this.ei=ff};mge.fu.fg=function(){let ft=Object.create(this);ft.ej=true;this.ei.push(ft);return ft};mge.fu.fl=function(){this.ej=false};mge.fu.fj=function(){this.ei=[]};mge.fu.fn=function(_method){this.ei.forEach(ft=>{ft[_method]();})};mge.hl.hm=function(){this.fv=[];this.fw=60;this.fx=1;this.fy=0;this.fz=0;this.cz='stopped'};mge.hl.gi=function(gj){let gk={C:32.7,Db:34.6,D:36.7,Eb:38.9,E:41.2,F:43.6,Gb:46.2,G:49,Ab:51.9,A:55,Bb:58.3,B:61.7};let gl=parseInt(gj.substr(gj.length-1,gj.length),10);let gm=gj.substr(0,gj.length-1);let am=gk[gm]*Math.pow(2,gl);return Math.round(am)};mge.hl.gb=function(gc,gd,bj){let gh=Object.create(mge.hl.gg);gh.gc=gc;gh.gd=gd;gh.bj=bj;mge.hl.fv.push(gh);return gh};mge.hl.go=function(gg,gq){let gt=gg.hi(gq);let gu=this.fy;for(let i=0;i<gt.length;i+=2){let gm=gt[i];let gmFrequency=this.gi(gm);let ae=gt[i+1]*60/this.fw;gg.gd.play(gmFrequency,gu,ae,gg.bj);gu+=ae}};mge.hl.gy=function(){if(mge.bi.ah.currentTime>=this.fz && this.cz=='started'){for(let i=0;i<this.fv.length;i++){let gg=this.fv[i];this.go(gg,this.fx)};this.fx+=1;this.fz=this.fy+3*60/this.fw;this.fy+=4*60/this.fw}};mge.hl.cf=function(){this.fx=1;this.fy=mge.bi.ah.currentTime;this.fz=0;this.cz='started'};mge.hl.hc=function(){this.cz='stopped'};mge.hl.gg={gc:[],gd:{},bj:1,bf:function(bj){if(bj<=0){this.bj=0}else if(bj>=1){this.bj=1}else{this.bj=bj}},hi:function(hj){let hk=this.gc.length;if(hk==0){return ''}else if(hj%hk==0){return this.gc[hk-1]}else{return this.gc[hj%hk-1]}}};mge.cj.hm(640,360)